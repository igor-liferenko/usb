Proper steps to cleanup original Atmel's code:
1. github init demo
2. download cdc archive from ub0ali dropbox avr-usb/ directory
3. unpack and cd
5. find . -type f | xargs perl -i -pe 's/\r$//'
10. patch -p1 <~/usb/cdc-fix.patch
1. git init
1. git add .
4. git clean -d -f &>/dev/null; find . -type f | grep -v '\.git' >/tmp/x
for i in `cat /tmp/x`; do rm $i; cd demo/E*/gcc; make &>/dev/null && echo git reset $i;
  cd ../../../; git checkout .; git clean -d -f &>/dev/null; done
4. run printed commands
4. git clean -d -f
8. cd demo/E*/gcc/; make &>/dev/null && avr-objdump -d *.elf >../../../objdump; cd ../../../
8. git add .
9. git ci -m "initial import"
14. ~/usb/mksurrogatehdr.sh $(~/usb/listsyshdrs.sh)
15. for i in $(find . -name \*.c); do mcpp -Dinclude=#include -P -W 0 -D__GNUC__ -I- -I ~/demo/ -I ~/demo/demo/EVK527-ATMega32U4-usbdevice_cdc/conf/ -I ~/demo/demo/EVK527-ATMega32U4-usbdevice_cdc/ -I ~/demo/system-headers/ $i | sponge $i; done
16. find . -name \*.h | xargs rm
17. git add .
8. cd demo/E*/gcc/; make &>/dev/null && avr-objdump -d *.elf >../../../objdump; cd ../../../
8. git diff objdump # must be empty - if not, fix
8. git add .
8. git ci -m "run preprocessor"
8. edit demo/EVK527-ATMega32U4-usbdevice_cdc/conf/config.h (change "#define FOSC" to 16000 and "#define PLL_OUT_FRQ" to PLL_OUT_48MHZ and "#define BAUDRATE" to 57600)
18. beginning with main.c replace each function body one by one (and check each time) until only main.c is left
